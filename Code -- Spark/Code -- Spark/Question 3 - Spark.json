{"paragraphs":[{"text":"%pyspark\nimport pyspark\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\n\nbusiness = sqlContext.read.json('hdfs://dumbo/user/ddp337/business.json')\nbusiness = business.map(lambda line: Row(business_id = line[2], categories = line[3], city = line[4], latitude = line[7], longitude = line[8],name = line[9])).toDF(sampleRatio = 0.2)\nreview = sqlContext.read.json('hdfs://dumbo/user/ddp337/review.json')","user":"anonymous","dateUpdated":"2018-03-28T11:06:44-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522206941964_224472092","id":"20180327-231541_1188393565","dateCreated":"2018-03-27T23:15:41-0400","dateStarted":"2018-03-28T11:06:44-0400","dateFinished":"2018-03-28T11:07:28-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5363"},{"text":"%pyspark\nbusiness_required= business.select(pyspark.sql.functions.explode(business.categories).alias('categories'),business.business_id,(pyspark.sql.functions.acos(0.82851924755*pyspark.sql.functions.sin((business.latitude)*3.14159/180)+0.5599605847*pyspark.sql.functions.cos((business.latitude)*3.14159/180)*pyspark.sql.functions.cos(-3.2096308*3.14159/180 - (business.longitude)*3.14159/180))*6371).alias('dist'))\n\nbusiness_required = business_required.filter(business_required['dist'] <= 15)\n\nreview_required = review.select(review.business_id,review.stars.cast(\"float\"),review.user_id)\nbusiness_required.registerTempTable('business_required')\nreview_required.registerTempTable('review_required')\n\n\n#business_required.show()","user":"anonymous","dateUpdated":"2018-03-28T12:47:05-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522207190402_803471570","id":"20180327-231950_1523398945","dateCreated":"2018-03-27T23:19:50-0400","dateStarted":"2018-03-28T11:44:51-0400","dateFinished":"2018-03-28T11:44:51-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5364","errorMessage":""},{"text":"%pyspark\nbusiness_plus_review = sqlContext.sql(\"SELECT * FROM business_required JOIN review_required ON business_required.business_id=review_required.business_id\")\nbusiness_plus_review_group = business_plus_review.groupBy('categories').avg('stars');\nbusiness_plus_review_group.show()","user":"anonymous","dateUpdated":"2018-03-28T11:45:19-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522207717704_-878142755","id":"20180327-232837_1002911737","dateCreated":"2018-03-27T23:28:37-0400","dateStarted":"2018-03-28T11:45:19-0400","dateFinished":"2018-03-28T11:46:07-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5365"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-03-28T01:15:34-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522214134816_700163160","id":"20180328-011534_703619066","dateCreated":"2018-03-28T01:15:34-0400","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5366"}],"name":"Question 3 - Spark","id":"2DB9ZGBB6","angularObjects":{"2CFXK5J4Y:shared_process":[],"2CF295UYG:shared_process":[],"2CD6ZRPDJ:shared_process":[],"2CFG6Y8G3:shared_process":[],"2CFJKQVBN:shared_process":[],"2CGYXR37V:shared_process":[],"2CDY97F39:shared_process":[],"2CEC5KMFB:shared_process":[],"2CFFWS5P3:shared_process":[],"2CDM4T1EH:shared_process":[],"2CG949ZHZ:shared_process":[],"2CEJ86HV3:shared_process":[],"2CFGNABPQ:shared_process":[],"2CEZV3CHG:shared_process":[],"2CDUTWP3P:shared_process":[],"2CFXDXWCE:shared_process":[],"2CEZMWG72:shared_process":[],"2CFWFHNZR:shared_process":[],"2CG23YGEZ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}