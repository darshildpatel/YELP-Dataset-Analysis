{"paragraphs":[{"text":"%pyspark\nimport pyspark\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\n\nbusiness = sqlContext.read.json('hdfs://dumbo/user/ddp337/business.json')\nbusiness = business.map(lambda line: Row(business_id = line[2], categories = line[3], city = line[4], latitude = line[7], longitude = line[8],name = line[9])).toDF(sampleRatio = 0.2)\nreview = sqlContext.read.json('hdfs://dumbo/user/ddp337/review.json')\nuser = sqlContext.read.json('hdfs://dumbo/user/ddp337/user.json')","user":"anonymous","dateUpdated":"2018-04-21T17:18:49-0400","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1524345383298_-2011025006","id":"20180328-103832_1546476866","dateCreated":"2018-04-21T17:16:23-0400","dateStarted":"2018-04-21T17:18:49-0400","dateFinished":"2018-04-21T17:19:56-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1470"},{"text":"%pyspark\nbusiness_required= business.select(pyspark.sql.functions.explode(business.categories).alias('categories'),business.business_id,(pyspark.sql.functions.acos(0.82851924755*pyspark.sql.functions.sin((business.latitude)*3.14159/180)+0.5599605847*pyspark.sql.functions.cos((business.latitude)*3.14159/180)*pyspark.sql.functions.cos(-3.2096308*3.14159/180 - (business.longitude)*3.14159/180))*6371).alias('dist'))\n\nbusiness_required = business_required.filter(business_required['dist'] <= 15)\nbusiness_required.registerTempTable('business_required')\n\nreview_required = review.select(review.business_id,review.stars.cast(\"float\"),review.user_id)\nreview_required.registerTempTable('review_required')\n\nuser_required = user.select(user.name,user.user_id)\nuser_required.registerTempTable('user_required')\nuser_required.show()","user":"anonymous","dateUpdated":"2018-04-21T17:23:01-0400","config":{"tableHide":false,"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+\n|   name|             user_id|\n+-------+--------------------+\n| Johnny|oMy_rEb0UBEmMlu-z...|\n|  Chris|JJ-aSuM4pCFPdkfoZ...|\n|  Tiffy|uUzsFQn_6cXDh6rPN...|\n|   Mark|mBneaEEH5EMyxaVyq...|\n| Evelyn|W5mJGs-dcDWRGEhAz...|\n|   Lisa|4E8--zUZO1Rr1IBK4...|\n|      B|Ob-2oGBQ7rwwYwUvh...|\n|  Peter|JaTVvKsBl0bHHJEpE...|\n|Colleen|Ykj0DVsz0c6rX9ghj...|\n|      A|kmyEPfKnHQJdTceCd...|\n|   Chad|H54pA7YHfjl8IjhHA...|\n|   Mike|WRae-wZkpRoxMrgJd...|\n|  Chris|Mmv5fPxbF8XEMN4EP...|\n|  Susan|LdqGHXsNQowMrvgTN...|\n|  Cathy|TsgBsn19Wjwpyo81g...|\n|   Cody|V--GjQPlTpeWbcB2c...|\n|Joselyn|a_gKYQ5YMg39FHNYJ...|\n|Rosalie|sz8Heh56kO_6_LBko...|\n|  Bobby|h5ERTYn2vQ1QbjTZv...|\n|   Hugo|jYnkJR3T8yCERXywo...|\n+-------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1524345383304_-2014872495","id":"20180328-103844_1007243799","dateCreated":"2018-04-21T17:16:23-0400","dateStarted":"2018-04-21T17:23:01-0400","dateFinished":"2018-04-21T17:23:01-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1471"},{"text":"%pyspark\nbusiness_plus_review = sqlContext.sql(\"SELECT * FROM business_required JOIN review_required ON business_required.business_id=review_required.business_id\")\nbusiness_plus_review_group = business_plus_review.groupBy('user_id').count();\nbusiness_plus_review_group= business_plus_review_group.sort(\"count\",ascending=False)\nbusiness_plus_review_group.show()","user":"anonymous","dateUpdated":"2018-04-21T17:52:39-0400","config":{"tableHide":true,"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----+\n|             user_id|count|\n+--------------------+-----+\n|Cy1PV2TdYeDFA16mU...| 2403|\n|utRlrauZEOF_2kASs...| 2132|\n|CqkdpG2tkCPQA69um...| 2110|\n|o0WGr8L3BWfH2Bslp...| 2052|\n|xXQTdJXPGOP-NUYct...| 1822|\n|5iRCT4uAsyP1UoEUo...| 1817|\n|SxV1Jq7UANuSYpn42...| 1795|\n|oEshN5oq98_g23MvE...| 1611|\n|nhVvcPyRGLw466qHV...| 1463|\n|4UQfst9jve4GCSfWp...| 1442|\n|txzOZrHK9EVY0kYjS...| 1438|\n|yfXqZkU5iXE07GSHz...| 1368|\n|fKi8ZF3xpJJkgSusR...| 1364|\n|oKdygoDX5CfDJeXzv...| 1336|\n|5Mujjzv-ZH6HhxT-h...| 1292|\n|UvIb5v3biEgcxWKnx...| 1255|\n|KPY6FvT6h-r0W0HAC...| 1119|\n|Z_xbO-Iaxbx-ZRPhL...| 1073|\n|frthTngbBHgSdk4j8...| 1065|\n|rJi2YPK6uj4FtE8R7...| 1036|\n+--------------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1524345383304_-2014872495","id":"20180328-104100_41520591","dateCreated":"2018-04-21T17:16:23-0400","dateStarted":"2018-04-21T17:23:06-0400","dateFinished":"2018-04-21T17:23:50-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1472"},{"text":"%pyspark\ntop_10_reviewers = sqlContext.createDataFrame(business_plus_review_group.head(10))\ntop_10_reviewers_categories = top_10_reviewers.join(business_plus_review, \"user_id\")\n\n#top_10_reviewers_categories.select('user_id').show()\ntop_10 = top_10_reviewers_categories.groupby('user_id','categories').avg('stars')\ntop_10.show()\n","user":"anonymous","dateUpdated":"2018-04-21T18:06:33-0400","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"},"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524345383305_-2015257244","id":"20180328-114930_1517761376","dateCreated":"2018-04-21T17:16:23-0400","dateStarted":"2018-04-21T18:02:14-0400","dateFinished":"2018-04-21T18:05:28-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1473","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------------+------------------+\n|             user_id|      categories|        avg(stars)|\n+--------------------+----------------+------------------+\n|SxV1Jq7UANuSYpn42...|       Nightlife| 3.452991452991453|\n|SxV1Jq7UANuSYpn42...|            Pubs|3.2777777777777777|\n|SxV1Jq7UANuSYpn42...|         Lounges|3.4615384615384617|\n|SxV1Jq7UANuSYpn42...|            Bars| 3.313131313131313|\n|SxV1Jq7UANuSYpn42...|            Food|3.6831683168316833|\n|SxV1Jq7UANuSYpn42...|  Internet Cafes|              3.25|\n|SxV1Jq7UANuSYpn42...| Flowers & Gifts|2.9411764705882355|\n|SxV1Jq7UANuSYpn42...|        Shopping| 3.314814814814815|\n|SxV1Jq7UANuSYpn42...|   Vinyl Records| 4.666666666666667|\n|SxV1Jq7UANuSYpn42...|           Books|3.9473684210526314|\n|SxV1Jq7UANuSYpn42...|            Mags|3.9473684210526314|\n|SxV1Jq7UANuSYpn42...|   Music & Video|3.9473684210526314|\n|SxV1Jq7UANuSYpn42...|      Bookstores|               4.1|\n|SxV1Jq7UANuSYpn42...|    Music & DVDs|               4.0|\n|SxV1Jq7UANuSYpn42...|         Jewelry|3.1818181818181817|\n|SxV1Jq7UANuSYpn42...|         Fashion|2.8333333333333335|\n|SxV1Jq7UANuSYpn42...|     Accessories|2.4545454545454546|\n|SxV1Jq7UANuSYpn42...|Women's Clothing|2.3333333333333335|\n|SxV1Jq7UANuSYpn42...|  Men's Clothing|              2.25|\n|SxV1Jq7UANuSYpn42...|         Turkish|              2.25|\n+--------------------+----------------+------------------+\nonly showing top 20 rows\n\n"}]}},{"text":"%pyspark\ntop_10 = top_10.join(user_required,\"user_id\")\ntop_10.drop('user_id').show()","user":"anonymous","dateUpdated":"2018-04-21T18:06:37-0400","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------------+--------+\n|          categories|        avg(stars)|    name|\n+--------------------+------------------+--------+\n|          Sandwiches| 3.676470588235294|Jonathan|\n|        Coffee & Tea|3.5757575757575757|Jonathan|\n|                Food|3.6831683168316833|Jonathan|\n|         Restaurants| 3.497354497354497|Jonathan|\n|           Nightlife| 3.452991452991453|Jonathan|\n|        Music Venues| 4.066666666666666|Jonathan|\n|         Dance Clubs| 3.533333333333333|Jonathan|\n|Arts & Entertainment| 4.113636363636363|Jonathan|\n|Juice Bars & Smoo...|             3.125|Jonathan|\n|          Brasseries|               3.4|Jonathan|\n|             British| 3.652173913043478|Jonathan|\n|               Cafes|3.4444444444444446|Jonathan|\n|            Scottish|               4.0|Jonathan|\n|          Toy Stores|              3.75|Jonathan|\n|      Souvenir Shops|               3.0|Jonathan|\n|     Flowers & Gifts|2.9411764705882355|Jonathan|\n|            Shopping| 3.314814814814815|Jonathan|\n|             Buffets|3.3333333333333335|Jonathan|\n|              Indian|              3.75|Jonathan|\n|          Vegetarian|               3.2|Jonathan|\n+--------------------+------------------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1524345383306_-2014102997","id":"20180328-120632_937586407","dateCreated":"2018-04-21T17:16:23-0400","dateStarted":"2018-04-21T18:06:37-0400","dateFinished":"2018-04-21T18:08:03-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1474"},{"text":"%pyspark\n","dateUpdated":"2018-04-21T17:16:23-0400","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524345383306_-2014102997","id":"20180420-004314_1838692001","dateCreated":"2018-04-21T17:16:23-0400","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1475"}],"name":"Question 4 - Spark","id":"2DDZAGT21","angularObjects":{"2CFXK5J4Y:shared_process":[],"2CF295UYG:shared_process":[],"2CD6ZRPDJ:shared_process":[],"2CFG6Y8G3:shared_process":[],"2CFJKQVBN:shared_process":[],"2CGYXR37V:shared_process":[],"2CDY97F39:shared_process":[],"2CEC5KMFB:shared_process":[],"2CFFWS5P3:shared_process":[],"2CDM4T1EH:shared_process":[],"2CG949ZHZ:shared_process":[],"2CEJ86HV3:shared_process":[],"2CFGNABPQ:shared_process":[],"2CEZV3CHG:shared_process":[],"2CDUTWP3P:shared_process":[],"2CFXDXWCE:shared_process":[],"2CEZMWG72:shared_process":[],"2CFWFHNZR:shared_process":[],"2CG23YGEZ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}