{"paragraphs":[{"text":"%pyspark\nimport pyspark\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\n\nbusiness = sqlContext.read.json('hdfs://dumbo/user/ddp337/business.json')\nbusiness = business.map(lambda line: Row(business_id = line[2], categories = line[3], city = line[4], latitude = line[7], longitude = line[8],name = line[9])).toDF(sampleRatio = 0.2)\nreview = sqlContext.read.json('hdfs://dumbo/user/ddp337/review.json')","user":"anonymous","dateUpdated":"2018-04-21T18:32:59-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524348177147_1876325163","id":"20180421-180257_1738418854","dateCreated":"2018-04-21T18:02:57-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:469","dateFinished":"2018-04-21T18:33:54-0400","dateStarted":"2018-04-21T18:32:59-0400","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nimport datetime\nfrom pyspark.sql.functions import year, month, dayofmonth\n\nbusiness_required= business.select(pyspark.sql.functions.explode(business.categories).alias('categories'),business.name,business.business_id,(pyspark.sql.functions.acos(0.82851924755*pyspark.sql.functions.sin((business.latitude)*3.14159/180)+0.5599605847*pyspark.sql.functions.cos((business.latitude)*3.14159/180)*pyspark.sql.functions.cos(-3.2096308*3.14159/180 - (business.longitude)*3.14159/180))*6371).alias('dist'))\n\nbusiness_required = business_required.filter(business_required['dist'] <= 15).filter(business_required['categories'] == \"Food\")\nbusiness_required.registerTempTable('business_required')\n\nreview_required = review.select(review.business_id,review.stars.cast(\"float\"),review.user_id,month('date').alias(\"month\"))\nreview_required.registerTempTable('review_required')","user":"anonymous","dateUpdated":"2018-04-21T20:31:09-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524349979309_1082161273","id":"20180421-183259_1393389067","dateCreated":"2018-04-21T18:32:59-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:497","dateFinished":"2018-04-21T20:31:10-0400","dateStarted":"2018-04-21T20:31:09-0400","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nfrom pyspark.sql import DataFrame\n\nbusiness_plus_review = business_required.join(review_required, \"business_id\");\nbusiness_plus_review_group = business_plus_review.groupBy('business_id').alias(avg('stars'),\"stars)\"\n\nsorted_reviewers = business_plus_review_group.sort('stars',ascending = False)\ntop_10_reviewers = sqlContext.createDataFrame(sorted_reviewers.head(10))\nsorted_reviewers = business_plus_review_group.sort(\"avg(stars)\",ascending = True)\nbottom_10_reviewers = sqlContext.createDataFrame(sorted_reviewers.head(10))\n#top_bottom = top_10_reviewers.unionall(bottom_10_reviewers)","user":"anonymous","dateUpdated":"2018-04-21T21:24:21-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524350362054_692529942","id":"20180421-183922_585126094","dateCreated":"2018-04-21T18:39:22-0400","status":"ERROR","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:582","dateFinished":"2018-04-21T21:24:21-0400","dateStarted":"2018-04-21T21:24:21-0400","results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-650245079030924704.py\", line 326, in <module>\n    code = compile('\\n'.join(final_code), '<stdin>', 'exec', ast.PyCF_ONLY_AST, 1)\n  File \"<stdin>\", line 4\n    sorted_reviewers = business_plus_review_group.sort('stars',ascending = False)\n                   ^\nSyntaxError: invalid syntax\n"}]}},{"text":"%pyspark\nsummary = top_10_reviewers.join(review_required, 'business_id')\nsummary = summary.filter(summary.month <=5)\nsummarized = summary.groupBy('business_id').avg('stars')\nsummarized = summarized.join(business_required, \"business_id\")\nsummarized.show()","user":"anonymous","dateUpdated":"2018-04-21T20:54:17-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524350927134_1702896401","id":"20180421-184847_2081946275","dateCreated":"2018-04-21T18:48:47-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:795","dateFinished":"2018-04-21T20:55:04-0400","dateStarted":"2018-04-21T20:54:17-0400","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+----------+--------------------+------------------+\n|         business_id|avg(stars)|categories|                name|              dist|\n+--------------------+----------+----------+--------------------+------------------+\n|wBOJAjuDW0VeJRgd4...|       2.0|      Food|       Tesco Express|0.5036395850340067|\n|KAJ18v-GByqi2THsm...|       1.0|      Food|   Taste Of Scotland|1.4118733974992523|\n|WxBZC1ry1tCZVmIO1...|       1.0|      Food|   Zucchero Cafe Bar|1.7082997070664092|\n|ES-iC1-_C3adpqgkB...|       1.0|      Food|           Peni Deli| 13.46586510543026|\n|HLgi9tJILVVsjmgDK...|       2.5|      Food|The Broadsheet Bi...|1.1528522677926947|\n|6RPX_sl-_eCJVcf8O...|       1.0|      Food|           Margiotta|2.9292635247112253|\n|oov10EOaEWk2euPuO...|       1.0|      Food|        Fresh Choice|2.0003650755965143|\n|nQ_bo9d_CeO4gf19v...|       1.5|      Food|Thaisanuk Restaurant|2.8820730754671358|\n+--------------------+----------+----------+--------------------+------------------+\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-04-21T19:48:15-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1524354495195_-753239886","id":"20180421-194815_1425586873","dateCreated":"2018-04-21T19:48:15-0400","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1295"}],"name":"Question 5 - Spark","id":"2DDD3GH3M","angularObjects":{"2CFXK5J4Y:shared_process":[],"2CF295UYG:shared_process":[],"2CD6ZRPDJ:shared_process":[],"2CFG6Y8G3:shared_process":[],"2CFJKQVBN:shared_process":[],"2CGYXR37V:shared_process":[],"2CDY97F39:shared_process":[],"2CEC5KMFB:shared_process":[],"2CFFWS5P3:shared_process":[],"2CDM4T1EH:shared_process":[],"2CG949ZHZ:shared_process":[],"2CEJ86HV3:shared_process":[],"2CFGNABPQ:shared_process":[],"2CEZV3CHG:shared_process":[],"2CDUTWP3P:shared_process":[],"2CFXDXWCE:shared_process":[],"2CEZMWG72:shared_process":[],"2CFWFHNZR:shared_process":[],"2CG23YGEZ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}